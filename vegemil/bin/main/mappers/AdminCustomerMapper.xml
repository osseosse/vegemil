<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vegemil.mapper.AdminCustomerMapper">

	<select id="selectGreenbiaMemberList" parameterType="hashMap" resultType="com.vegemil.domain.MemberDTO">
		SELECT /* selectGreenbiaMemberList by AdminCustomerMapper.xml */ 
		       m_idx, m_id, m_name, m_year, m_sex, m_hp, m_email, m_joindate, m_logincount,
		       m_comp_name, m_bizno, m_greenbia_pay
		  FROM m_member
		 WHERE m_type = 3
		 <if test='sStartdate != "" '>
	       AND m_joindate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND m_joindate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (m_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_id like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or	m_email like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or m_comp_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
		 ORDER BY m_idx DESC
		 LIMIT #{start, jdbcType=INTEGER}, #{length, jdbcType=INTEGER}
	</select>

	<select id="selectGreenbiaMemberTotalCount" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) /* selectGreenbiaMemberTotalCount by AdminCustomerMapper.xml */
		  FROM m_member
		 WHERE m_type = 3
		 <if test='sStartdate != "" '>
	       AND m_joindate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND m_joindate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (m_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_id like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or	m_email like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or m_comp_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
	</select>
	
	<delete id="deleteGreenbiaMember" parameterType="Long">
		DELETE FROM m_member
		WHERE
			m_idx = #{mIdx}
		AND 
		    m_type = 3
		AND 
		    m_auth = 'COMP'
	</delete>
	
	<select id="selectGreenbiaMember" parameterType="Long" resultType="com.vegemil.domain.MemberDTO">
		SELECT /* selectGreenbiaMember by AdminCustomerMapper.xml */ 
		       m_idx, m_id, m_name, m_year, m_sex, m_hp, m_email, m_joindate, m_logincount,
		       m_comp_name, m_bizno, m_greenbia_pay, m_smssend, m_emailsend, m_active,
		       m_dual_yn
		  FROM m_member
		 WHERE m_idx = #{mIdx}
<!-- 		   AND m_type = 3 -->
	</select>
	
	<update id="updateGreenbiaMember" parameterType="com.vegemil.domain.MemberDTO">
		 /* updateGreenbiaMember by AdminCustomerMapper.xml */ 
		<if test='mActive == "1" '>
		UPDATE m_member 
		SET 
		    m_sex = #{mSex},
		    m_hp = #{mHp},
		    m_email = #{mEmail},
		    m_emailsend = #{mEmailsend},
		    m_type = #{mType},
		    m_greenbia_pay = #{mGreenbiaPay},
		    m_smssend = #{mSmssend},
		    m_active = #{mActive},
		    m_leavedate = NOW(),
		    m_leavememo = #{mLeavememo}
		WHERE
		    m_idx = #{mIdx}
		</if>
		<if test='mActive == "0" '>
		UPDATE m_member 
		SET 
		    m_sex = null,
		    m_year = null,
		    m_pwd = null,
		    m_hp = null,
		    m_tel = null,
		    m_zipcode = null,
		    m_addr1 = null,
		    m_addr2 = null,
		    m_email = null,
		    m_emailsend = null,
		    m_type = null,
		    m_greenbia_pay = null,
		    m_smssend = null,
		    m_active = 0,
		    m_leavedate = NOW(),
		    m_leavememo = #{mLeavememo}
		WHERE
		    m_idx = #{mIdx}
		</if>
	</update>
	
	<select id="selectMemberTotalCount" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) /* selectMemberTotalCount by AdminCustomerMapper.xml */
		  FROM m_member
		 WHERE m_type IN ('0', '1', '3')
		 <if test='sStartdate != "" '>
	       AND m_joindate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND m_joindate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (m_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_id like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or	m_email like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or m_comp_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
	</select>
	
	<select id="selectMemberList" parameterType="hashMap" resultType="com.vegemil.domain.MemberDTO">
		SELECT /* selectMemberList by AdminCustomerMapper.xml */ 
		       m_idx, m_id, m_name, m_year, m_sex, m_hp, m_email, m_joindate, m_logincount,
		       m_comp_name, m_bizno, m_dual_yn, m_addr1, m_addr2
		  FROM m_member
		 WHERE m_type IN ('0', '1', '3')
		 <if test='sStartdate != "" '>
	       AND m_joindate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND m_joindate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (m_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_id like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or	m_email like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or m_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   	 or m_comp_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
		 ORDER BY m_joindate DESC
		 LIMIT #{start, jdbcType=INTEGER}, #{length, jdbcType=INTEGER}
	</select>
	
	<select id="selectMember" parameterType="Long" resultType="com.vegemil.domain.MemberDTO">
		SELECT /* selectMember by AdminCustomerMapper.xml */ 
		       m_idx, m_id, m_name, m_year, m_sex, m_hp, m_email, m_joindate, m_logincount,
		       m_comp_name, m_bizno, m_greenbia_pay, m_smssend, m_emailsend, m_active,
		       m_dual_yn, m_type, m_leavedate, m_leavememo, m_addr1, m_addr2, m_zipcode
		  FROM m_member
		 WHERE m_idx = #{mIdx}
	</select>
	
	<update id="updateMember" parameterType="com.vegemil.domain.MemberDTO">
		 /* updateMember by AdminCustomerMapper.xml */ 
		<if test='action == "U" '>
		UPDATE m_member 
		SET 
		    m_sex = #{mSex},
		    m_year = #{mYear},
		    m_addr1 = #{mAddr1},
		    m_addr2 = #{mAddr2},
		    m_hp = #{mHp},
		    m_email = #{mEmail},
		    m_emailsend = #{mEmailsend},
		    m_greenbia_pay = #{mGreenbiaPay},
		    m_smssend = #{mSmssend},
		    m_leavedate = NOW(),
		    m_leavememo = #{mLeavememo}
		WHERE
		    m_idx = #{mIdx}
		</if>
		<if test='action == "D" '>
		UPDATE m_member 
		SET 
		    m_sex = null,
		    m_year = null,
		    m_pwd = null,
		    m_hp = null,
		    m_tel = null,
		    m_zipcode = null,
		    m_addr1 = null,
		    m_addr2 = null,
		    m_email = null,
		    m_emailsend = null,
		    m_type = null,
		    m_greenbia_pay = null,
		    m_smssend = null,
		    m_active = 0,
		    m_leavedate = NOW(),
		    m_leavememo = #{mLeavememo}
		WHERE
		    m_idx = #{mIdx}
		</if>
	</update>
	
	<select id="selectVisitList" parameterType="hashMap" resultType="com.vegemil.domain.AdminVisitDTO">
		SELECT /* selectVisitList by AdminCustomerMapper.xml */ 
		       v_idx, v_writedate, v_name, v_tel, v_hp, v_email, v_area, v_addr, v_org, v_pcount,
		       v_appdate, v_apptime, v_memo, v_confstat, v_confdate, v_conftime, v_adminmemo,
		       v_area, v_display, v_cancel
		  FROM m_visit
		 WHERE 1=1
		 <if test='sStartdate != "" '>
	       AND v_writedate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND v_writedate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (v_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or v_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
		 ORDER BY v_writedate DESC
		 LIMIT #{start, jdbcType=INTEGER}, #{length, jdbcType=INTEGER}
	</select>

	<select id="selectVisitTotalCount" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) /* selectVisitTotalCount by AdminCustomerMapper.xml */
		  FROM m_visit
		 WHERE 1=1
		 <if test='sStartdate != "" '>
	       AND v_writedate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND v_writedate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (v_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or v_hp like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
	</select>
	
	<update id="updateVisit" parameterType="com.vegemil.domain.AdminVisitDTO">
		 /* updateVisit by AdminCustomerMapper.xml */ 
		UPDATE m_visit 
		SET 
		    <if test='vConfstat == "1" or vConfstat =="2" '>
		    v_confstat = #{vConfstat},
		    </if>
		    <if test='vConfstat == "3"  '>
		    v_cancel = 1,
		    </if>
		    v_apptime = #{vApptime},
		    v_confdate = #{vConfdate},
		    v_conftime = #{vConftime},
		    v_adminmemo = #{vAdminmemo}
		    
		    
		WHERE
		    v_idx = #{vIdx}
	</update>
	
	<update id="deleteVisit" parameterType="hashMap">
		/* deleteVisit by AdminCustomerMapper.xml */
		DELETE 
		  FROM m_visit
		 WHERE v_idx IN
	  <foreach collection='list' index='index' item='idx' open='(' close=')' separator=','> 
		 #{idx, jdbcType=VARCHAR}
	  </foreach>
	</update>
	
	<select id="selectVisitDetail" parameterType="Long" resultType="com.vegemil.domain.AdminVisitDTO">
		SELECT /* selectVisitDetail by AdminCustomerMapper.xml */ 
		       v_idx, v_display
		  FROM m_visit
		 WHERE v_idx = #{vIdx}
	</select>
	
	<update id="updateDisplayVisit" parameterType="com.vegemil.domain.AdminVisitDTO">
		 /* updateDisplayVisit by AdminCustomerMapper.xml */ 
		UPDATE m_visit 
		SET 
		    v_display = #{vDisplay}
		WHERE
		    v_idx = #{vIdx}
	</update>
	
	<select id="selectFactoryTourReviewList" parameterType="hashMap" resultType="com.vegemil.domain.AdminFactpostDTO">
		SELECT /* selectFactoryTourReviewList by AdminCustomerMapper.xml */ 
		       s_idx, s_cate, s_id, s_name, s_email, s_addr, s_best, s_subject, s_content, s_file,
		       s_writedate, s_writetime, s_activeuser, s_hit, s_active, s_file2, s_url, s_hp
		  FROM m_factpost
		 WHERE 1=1
		 <if test='sStartdate != "" '>
	       AND s_writedate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND s_writedate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (v_subject like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or v_content like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   		v_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
		 ORDER BY s_writedate DESC
		 LIMIT #{start, jdbcType=INTEGER}, #{length, jdbcType=INTEGER}
	</select>

	<select id="selectFactoryTourReviewTotalCount" parameterType="hashMap" resultType="int">
		SELECT COUNT(*) /* selectFactoryTourReviewTotalCount by AdminCustomerMapper.xml */
		  FROM m_factpost
		 WHERE 1=1
		 <if test='sStartdate != "" '>
	       AND s_writedate &gt;= #{sStartdate, jdbcType=VARCHAR} 
	     </if>
	     <if test='sEnddate != "" '>
	       AND s_writedate &lt;= #{sEnddate, jdbcType=VARCHAR}
	     </if>
	     <if test='searchWord != "" '>
		   AND (v_subject like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%') or v_content like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%')
		   		v_name like CONCAT('%',#{searchWord, jdbcType=VARCHAR},'%'))  
		 </if>
	</select>
	
	<select id="selectVisitSetup" resultType="com.vegemil.domain.AdminVisitSetupDTO">
		SELECT /* selectVisitSetup by AdminCustomerMapper.xml */ 
		       s_closedate, s_month1, s_month2, s_msg1, s_msg2
		  FROM m_visit_setup
	</select>
	
	<update id="updateVisitSetup" parameterType="com.vegemil.domain.AdminVisitSetupDTO">
		 /* updateVisitSetup by AdminCustomerMapper.xml */ 
		UPDATE m_visit_setup
		SET 
		    s_closedate = #{sClosedate},
		    s_month1 = #{sMonth1},
		    s_month2 = #{sMonth2},
		    s_msg1 = #{sMsg1},
		    s_msg2 = #{sMsg2}
	</update>

</mapper>